# 「少女前线」跨服手册（散爆版）（安卓模拟器 → iOS 官服）
 > By: [Mornwind](https://github.com/Mornwind)
 > 
 > Blog: [Mornwind’s Blog](https://blog.mornwind.cc)（博客中也有教程，使用的是国内备用仓库）
 > 
 > GitHub Repo: [Mornwind/GFCN_SwitchServer](https://github.com/Mornwind/GFCN_SwitchServer) 
 > 
 > Gitee Repo: [Mornwind/GFCN_SwitchServer](https://gitee.com/Mornwind/GFCN_SwitchServer) (国内备用仓库，配置中链接已全部替换成 gitee.com，防止国内无法访问 GitHub)
 > 
 > QQ Group：
 > > 【霞之丘 · 少前跨服】:[`915089623`](https://jq.qq.com/?_wv=1027&k=5rnvPAT)（本群已于 2021/8/12 10:59 被封，损失惨重，故新群拆分成两个，分别运作）
 > > 
 > > 【霞之丘⟡少前跨服答疑】：[`907757876`](https://jq.qq.com/?_wv=1027&k=wdMRfleu)（仅跨服答疑，勿水无关话题）（请先填写[【少前跨服情况统计】](https://docs.qq.com/form/page/DREpKbGVaQWtRcGhI)收集表，便于管理员有针对性地答疑及后期通知）
 > > 
 > > 【霞之丘⟡闲聊群】：[`908042781`](https://jq.qq.com/?_wv=1027&k=Ph1teaIm)（仅闲聊，不答疑）

## 致谢

- **参考&协助**
  - 霞ヶ丘詩羽x / 浪速の白雪姬：[GitHub](https://gitee.com/KasumigaokaUtaha) / [Gitee](https://gitee.com/silvercrowsaki) / [Bilibili](https://space.bilibili.com/455501) / [NGA](https://bbs.nga.cn/thread.php?authorid=42650362)
    - B 站专栏：[少女前线 跨服 iOS安卓国服（cv3630717）](https://www.bilibili.com/read/cv3630717)
    - B 站专栏：[少前B服（散爆）iOS 跨服（cv3677605）](https://www.bilibili.com/read/cv3677605)（专栏文章已被 B 站删除）
  - LNarga / MoonNarga：[GitHub](https://github.com/MoonNarga)
    - GitHub：[Server_Switch_for_GirlsFrontline](https://github.com/MoonNarga/Server_Switch_for_GirlsFrontline)

---

## ⚠️ 注意事项 ⚠️

1. 本项目内所提到的所有客户端与服务器，均为**国服**。
2. 跨服脚本代码**公开透明**地存放于本项目中，欢迎随时进行检查。跨服脚本中**并未含有**用于修改游戏内数据以获得不正当收益的作弊内容，只是用来切换登录服务器。但从原则上来说还是属于违反用户协议的行为，会不会被封号要看官方的心情。如若不放心，还请另寻他法（但是跨服的原理都是一样的，要真查起来都跑不掉）。
3. **无法进行跨服充值，否则 1000% 会错充进客户端对应的原服务器，切记！**

---

## 📖 跨服手册 📖

### ⑴ HttpCanary
 > 需 HttpCanary 为新版 3.3.6 (58) 或旧版 9.2.8.1 (916) 的高级（Premium）版本。
 > 
 > 因少前 3.0 大版本更新后，安全措施升级，跨服时需用到 HTTPS 解密，故使用 HttpCanary 时需先**安装 HttpCanary 根证书**；安装证书时，对于 Android 7.0 以下系统可**无需 Root**，但对于 Android 7.0 及以上系统，由于证书方面的安全策略，导致**需 Root**后**手动将用户证书转为系统证书**才可正常进行跨服。
 > 
 > 另注：开发者已主动下架此应用基础版及高级版，只能通过其他途径获取。

| 模拟器 | Android 版本 | 工具适用<br />3.3.6 | 工具适用<br />9.2.8.1 | 备注 |
| :-: | :-: | :-: | :-: | :-: |
| MuMu 模拟器 2.x（蓝标） | 6.0.1 (Marshmallow) | ✅ | ✅ | - |
| MuMu 模拟器 星云引擎版（黄标） | 7.1.2 (Nougat) | ❌ | ❌ | 安装工具时闪退 |
| MuMu 模拟器 9.x Beta（蓝标） | 9 (Pie) | ✅ | ❌ | 9.2.8.1：游戏服务器连接异常 |
| 雷电模拟器 3.x | 5.1.1 (Lollipop) | ❌ | ❌ | 3.3.6：抓包功能启动失败<br />9.2.8.1：获取服务器列表失败 |
| 雷电模拟器 4.x | 7.1.2 (Nougat) | ✅ | ✅ | - |
| 夜神模拟器 7.x | 7.1.2 (Nougat) | ❌ | ❌ | 3.3.6：抓包功能启动失败<br />9.2.8.1：游戏服务器连接异常 |
| 逍遥模拟器 8.x | 7.1.2 (Nougat) | ✅ | ⚠️ | 9.2.8.1：会多次提示“数据配置获取失败”，但可以继续 |
| BlueStacks 4 | 7.1.2 (Nougat) | ❌ | ❌ | 3.3.6：打开工具时先白屏后闪退<br />9.2.8.1：无限提示“数据配置获取失败” |
| BlueStacks 5 | 7.1.1 (Nougat) | ❌ | ❌ | 3.3.6：打开工具时先白屏后闪退<br />9.2.8.1：无限提示“数据配置获取失败” |
| BlueStacks 5 Beta | 9 (Pie) | ✅ | ⚠️ | 9.2.8.1：会提示一次“数据配置获取失败”，但可以继续 |

（本表格最后更新日期：2022/09/03）

<details>
<summary>点击查看：配置跨服（适用于 HttpCanary 3.3.6 (58) 版本）</summary>

1. **安装 HttpCanary 根证书**：在首页，点击左上角“☰”按钮打开侧栏菜单，找到“设置”点击进入；在“设置”界面中，找到“抓包设置”组中的“HttpCanary 根证书”点击进入；在“HttpCanary 根证书”界面中，点击“安装 HttpCanary 根证书”；然后按照系统提示执行以下操作完成证书安装：设置 PIN 码或密码（对于从未设置过的）→输入 PIN 码或密码（若反复弹出输入窗口，将模拟器旋转固定竖屏即可解决）→安装证书（提示为“为证书命名”）；然后返回 HttpCanary，可看到“安装 HttpCanary 根证书”下方提示“已安装”。
2. **将用户证书转为系统证书（仅 Android 7.0 及以上系统需操作）**：在“HttpCanary 根证书”界面中，点击“添加根证书至系统（Root）”，在“安装证书至系统 CA”界面中点击下方“移动”按钮；在弹出的“超级用户请求”弹窗中，选择“永久记住选择”并点击“允许”，即为 HttpCanary 授予 Root 权限；然后在弹出的“安装成功”消息中点“好的”；然后返回首页。
3. **设置目标应用**：在 HttpCanary 首页，点击左上角“☰”按钮打开侧栏菜单，找到“目标应用”点击进入；在“目标应用”界面中，点击右上角“+”按钮进入选择应用界面；在应用列表中找到“少女前线（com.sunborn.girlsfrontline.cn）”，点击即完成添加并自动返回“目标应用”界面，可看到界面中已出现上述应用；然后点击左上角“←”按钮返回首页。
4. **设置白名单**：在首页，点击左上角“☰”按钮打开侧栏菜单，找到“黑白名单”点击进入；在“黑白名单”界面中，点击右上角“+”按钮，进入“添加 Host”界面；在“添加 Host”界面中，输入域名“gfcn-transit.gw.sunborngame.com”，然后点击右上角“✓”按钮完成添加并返回“黑白名单”界面，可看到界面中已出现上述域名，且右侧有蓝色对勾，即表示成功添加此域名到白名单；然后点击左上角“←”按钮返回首页。
5. **设置允许后台运行**：（各安卓定制系统设置方法有差异，此处不详述）将 HttpCanary 设置为允许后台运行，防止进入后台后被系统自动清理。
6. **抓取指定域名**：在首页，点击右下角纸飞机图标以启动 HttpCanary（图标变绿）；运行游戏，直至选择服务器界面（即：左上角显示“当前服务器：0服 格里芬”，下方显示“点击屏幕开始”），退出游戏并清掉游戏后台；然后再切回 HttpCanary 并点击右下角纸飞机图标以停止 HttpCanary（图标变蓝）；此时可在首页看到刚抓到的一条“少女前线”的记录，且下方显示为“POST https://gfcn-transit.gw.sunborngame.com/index.php”。
7. **为指定域名设置重写器（第一部分）**：长按第 6 步中抓到的记录，在弹出的“选择操作”菜单中，点击“重写”；在弹出的“命名重写器”界面中，为重写器取个名（如：GFCN_Adr2iOS），然后点击右上角“→”按钮；在弹出的“创建重写器”界面中，先找到“请求”→“Headers”→“Host”点击进入，然后将第二行中的“gw”替换成“ios”（即：将“gfcn-transit.gw.sunborngame.com”修改为“gfcn-transit.ios.sunborngame.com”），点击右上角“✓”按钮保存后自动返回“创建重写器”界面。
8. **为指定域名设置重写器（第二部分）**：以下两种方法**任选其一**：<br />（1）**方法一**：在“创建重写器”界面中，找到“请求”→“请求体”→“跟随客户端”，点击右侧笔状图标，在弹出的“选择方式”菜单中选择“规则替换”，在弹出的“规则编辑器”界面中，分三次点击右下角“+”按钮进入“新建规则”界面并完成以下操作：第一次在“名称”中填入“channel”，“匹配”中填入“channel=cn_mica”，“替换”中填入“channel=cn_appstore”，点击右上角“✓”按钮保存；第二次在“名称”中填入“device”，“匹配”中填入“device=adr”，“替换”中填入“device=ios”，点击右上角“✓”按钮保存；第三次在“名称”中填入“platformChannelId”，“匹配”中填入“platformChannelId=GWGW”，“替换”中填入“platformChannelId=ios”，点击右上角“✓”按钮保存；当“规则编辑器”界面显示了刚刚添加好的三条“文字替换”后，点击右上角“✓”按钮保存并自动返回“创建重写器”界面；在“创建重写器”界面，再点击右上角纸飞机图标，在弹出的“重写器创建成功”窗口中点击“好的”，完成重写器设置。<br />（2）**方法二**：在“创建重写器”界面中，找到“请求”→“请求体”→“跟随客户端”，点击右侧笔状图标，在弹出的“选择方式”菜单中选择“在线编辑”，在弹出的“Body”界面中，将“channel=”后的“cn_mica”替换为“cn_appstore”，将“device=”后的“adr”替换为“ios”，将“platformChannelId=”后的“GWGW”替换为“ios”，然后点击右上角“✓”按钮保存并自动返回“创建重写器”界面；在“创建重写器”界面，再点击右上角纸飞机图标，在弹出的“重写器创建成功”窗口中点击“好的”，完成重写器设置。
9. **启动 HttpCanary**：点击首页右下角纸飞机图标以启动 HttpCanary（图标变绿），即可在安卓模拟器跨服登录 iOS 国服。（如无其他使用需求，成功跨服进入游戏后便可停止 HttpCanary。）

</details>

<details>
<summary>点击查看：配置跨服（适用于 HttpCanary 9.2.8.1 (916) 版本）</summary>

1. **安装 HttpCanary 根证书**：在首页，点击左上角“☰”按钮打开侧栏菜单，点击左下角“设置”;在“设置”界面中，进入“抓包设置”→“SSL 证书设置”；在“SSL 证书设置”界面中，点击“安装 HttpCanary 根证书”；然后按照系统提示执行以下操作完成证书安装：设置 PIN 码或密码（对于从未设置过的）→输入 PIN 码或密码（若反复弹出输入窗口，将模拟器旋转固定竖屏即可解决）→安装证书（提示为“为证书命名”）。
2. **将用户证书转为系统证书（仅 Android 7.0 及以上系统需操作）**：返回模拟器主屏幕，在系统应用中找到“文件管理器”（或自己安装的文件管理工具，如 Root Explorer 等）并打开，授予文件管理器 Root 权限；然后将用户证书目录“/data/misc/user/0/cacerts-added”中名为“87bc3517.0”的证书文件（若存在后缀为“.1”的证书也一并选中复制）复制到系统证书目录“/system/etc/security/cacerts”中；关闭文件管理器并返回至 HttpCanary 主界面。
3. **设置目标应用**：在 HttpCanary 首页，点击左上角“☰”按钮打开侧栏菜单，点击左下角“设置”;在“设置”界面中，进入“抓包设置”→“目标应用”；在“目标应用”界面中，点击右上角“+”按钮进入选择应用界面；在应用列表中找到“少女前线（com.sunborn.girlsfrontline.cn）”，点击即完成添加并自动返回“目标应用”界面，可看到界面中已出现上述应用；然后点击左上角“←”按钮返回“设置”界面。
4. **设置白名单**：在“设置”界面中，进入“抓包设置”→“目标Host”；在“目标Host”界面中，点击右上角“+”按钮，进入“添加 Host”界面；在“添加 Host”界面中，输入域名“gfcn-transit.gw.sunborngame.com”，然后点击右上角“✓”按钮完成添加并返回“目标Host”界面，可看到界面中已出现上述域名，即表示成功添加此域名到目标列表；然后点击两次左上角“←”按钮返回至首页。
5. **设置允许后台运行**：（各安卓定制系统设置方法有差异，此处不详述）将 HttpCanary 设置为允许后台运行，防止进入后台后被系统自动清理。
6. **抓取指定域名**：在首页，点击右下角纸飞机图标以启动 HttpCanary（图标变绿）；运行游戏，直至选择服务器界面（即：左上角显示“当前服务器：0服 格里芬”，下方显示“点击屏幕开始”），退出游戏并清掉游戏后台；然后再切回 HttpCanary 并点击右下角纸飞机图标以停止 HttpCanary（图标变蓝）；此时可在首页看到刚抓到的一条“少女前线”的记录，且下方显示为“POST https://gfcn-transit.gw.sunborngame.com/index.php”。
7. **为指定域名设置静态注入器（第一部分）**：长按第 6 步中抓到的记录，在弹出的“选择操作”菜单中，点击“静态注入”；在弹出的“命名注入器”界面中，为注入器取个名（如：GFCN_Adr2iOS），然后点击右上角“→”按钮；在弹出的“创建静态注入器”界面中，先找到“请求”→“Headers”→“Host”点击进入，然后将第二行中的“gw”替换成“ios”（即：将“gfcn-transit.gw.sunborngame.com”修改为“gfcn-transit.ios.sunborngame.com”），点击右上角“✓”按钮保存后自动返回“创建静态注入器”界面。
8. **为指定域名设置静态注入器（第二部分）**：在“创建静态注入器”界面中，找到“请求”→“请求体”→“跟随客户端”，点击右侧笔状图标，在弹出的“选择方式”菜单中选择“在线编辑”，在弹出的“Body”界面中，将“channel=”后的“cn_mica”替换为“cn_appstore”，将“device=”后的“adr”替换为“ios”，将“platformChannelId=”后的“GWGW”替换为“ios”，然后点击右上角“✓”按钮保存并自动返回“创建静态注入器”界面；在“创建静态注入器”界面，再点击右上角纸飞机图标，在弹出的“静态注入器创建成功”窗口中点击“好的”，完成静态注入器设置。
9. **启动 HttpCanary**：点击首页右下角纸飞机图标以启动 HttpCanary（图标变绿），即可在安卓模拟器跨服登录 iOS 国服。（如无其他使用需求，成功跨服进入游戏后便可停止 HttpCanary。）

</details>

### ⑵ 模拟器跨服工具（自编译）
 > 需用到 [MoonNarga](https://github.com/MoonNarga) 的项目 [Server_Switch_for_GirlsFrontline](https://github.com/MoonNarga/Server_Switch_for_GirlsFrontline)。

<details>
<summary>此方法在少前 3.0 大版本更新后暂时失效，请静待 @MoonNarga 大佬更新工具</summary>

| 模拟器 | Android 版本 | 工具适用 | 备注 |
| :-: | :-: | :-: | :-: |
| MuMu 模拟器 2.x（蓝标） | 6.0.1 (Marshmallow) | ✅ | - |
| MuMu 模拟器 星云引擎版（黄标） | 7.1.2 (Nougat) | ❌ | 网络设置被精简 |
| MuMu 模拟器 9.x Beta（蓝标） | 9 (Pie) | ❌ | 网络设置被精简 |
| 雷电模拟器 3.x | 5.1.1 (Lollipop) | ✅ | - |
| 雷电模拟器 4.x | 7.1.2 (Nougat) | ❌ | 代理设置无效 |
| 夜神模拟器 7.x | 7.1.2 (Nougat) | ✅ | - |
| 逍遥模拟器 8.x | 7.1.2 (Nougat) | ✅ | - |
| BlueStacks 4 | 7.1.2 (Nougat) | ❌ | 网络设置被精简 |
| BlueStacks 5 | 7.1.1 (Nougat) | ❌ | 网络设置被精简 |
| BlueStacks 5 Beta | 9 (Pie) | ❌ | 网络设置被精简 |

（本表格最后更新日期：2022/05/29）

<details>
<summary>点击查看：配置跨服</summary>

1. **准备模拟器跨服工具**：先自行对 [MoonNarga](https://github.com/MoonNarga) 的项目 [Server_Switch_for_GirlsFrontline](https://github.com/MoonNarga/Server_Switch_for_GirlsFrontline) 进行编译，得到可运行的模拟器跨服工具（若是在跨服群中下载已经编译好的跨服工具，则跳过第 1 步）。
2. **启动模拟器跨服工具**：运行模拟器跨服工具，待工具启动完成后，记录下窗口中显示的“监听本机地址”及“端口”；保持模拟器跨服工具开启，并确认没有出现错误提示。
3. **配置安卓模拟器的网络代理**：因安卓模拟器不同品牌及版本的设置方法略有区别，请对应查阅：<br />（1）**MuMu 模拟器 v2.x（蓝标，Android 6.0.1）**：点击模拟器桌面上“系统应用”文件夹→“设置”，设置页面中进入“无线和网络”→“WLAN”中；长按其中显示的网络（网络名随机生成），在弹出的菜单中选择“修改网络”，再展开“高级选项”，将“代理”设置为“手动”，在出现的“代理服务器主机名”和“代理服务器端口”中依次填入第 2 步中记下的内容；点击”保存“返回。<br />（2）**雷电模拟器 v3.x（Android 5.1.1）**：点击模拟器桌面上“系统应用”文件夹→“设置”，在设置页面中进入“无线和网络”→“WLAN”中；长按其中显示的网络（网络名可能为“James”），在弹出的菜单中选择“修改网络”，再勾选“高级选项”，将“代理”设置为“手动”，在出现的“代理服务器主机名”和“代理服务器端口”中依次填入第 2 步中记下的内容；点击”保存“返回。<br />（3）**夜神模拟器 v7.x（Android 7.1.2）**：点击模拟器桌面上“工具”文件夹→“设置”，设置页面中进入“无线和网络”→“WLAN”中；长按其中显示的网络（网络名可能为“WiredSSID”），在弹出的菜单中选择“修改网络”，再展开“高级选项”，将“代理”设置为“手动”，在出现的“代理服务器主机名”和“代理服务器端口”中依次填入第 2 步中记下的内容；点击”保存“返回。<br />（4）**逍遥模拟器 v8.x（Android 7.1.2）**：点击模拟器桌面上“系统应用”文件夹→“设置”，设置页面中进入“无线和网络”→“WLAN”中；长按其中显示的网络（网络名随机生成），在弹出的菜单中选择“修改网络”，再展开“高级选项”，将“代理”设置为“手动”，在出现的“代理服务器主机名”和“代理服务器端口”中依次填入第 2 步中记下的内容；点击”保存“返回。
4. **启动游戏**：在清除了游戏后台的情况下进入游戏，即可在安卓模拟器上跨服登录 iOS 国服。（如无其他使用需求，不玩游戏时别忘了关闭模拟器跨服工具。）

</details>

</details>

---

[返回前言](/README.md)
